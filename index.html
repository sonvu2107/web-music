<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlowPlay ‚Äî Tr√¨nh nghe nh·∫°c</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0e0f13">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="styles/mongodb.css">
</head>

<body>
  <div class="app" id="app">
    <aside class="sidebar" aria-label="Thanh ƒëi·ªÅu h∆∞·ªõng">
      <div class="logo">
        <div class="dot"></div>
        <div>FlowPlay</div>
      </div>
      <nav>
        <div class="nav-group">
          <div class="nav-title">Duy·ªát</div>
          <button class="nav-btn active" data-route="home"><img src="assets/icons/home.svg" width="20"
              height="20" />Trang ch·ªß</button>
          <button class="nav-btn" data-route="library"><img src="assets/icons/library.svg" width="20" height="20" />Th∆∞
            vi·ªán <span class="badge" id="lib-count">0</span></button>
          <button class="nav-btn" data-route="playlists"><img src="assets/icons/list.svg" width="20"
              height="20" />Playlist</button>
          <button class="nav-btn" data-route="settings"><img src="assets/icons/settings.svg" width="20"
              height="20" />C√†i ƒë·∫∑t</button>
        </div>
      </nav>
      <div style="margin-top:auto; display:flex; gap:8px;">
        <button class="btn secondary" id="btn-new-playlist"><img src="assets/icons/add.svg" width="18" height="18" />
          Playlist m·ªõi</button>
        <button class="btn ghost" id="btn-upload"><img src="assets/icons/add.svg" width="18" height="18" /> Th√™m
          nh·∫°c</button>
        <input id="file-input" type="file" multiple accept="audio/*" style="display:none;" />
      </div>
    </aside>

    <header>
      <div class="search">
        <img src="assets/icons/search.svg" width="18" height="18" />
        <input id="search-input" placeholder="T√¨m b√†i h√°t, ngh·ªá sƒ©, album..." />
      </div>
      <div class="header-actions">
        <button class="icon-btn" id="theme-toggle" title="ƒê·ªïi ch·ªß ƒë·ªÅ"><img src="assets/icons/moon.svg" width="20"
            height="20" /></button>
        
        <!-- Login button (shown when not logged in) -->
        <button class="icon-btn" id="btn-login" title="ƒêƒÉng nh·∫≠p" onclick="authUI.showModal()" style="display: block;"><img src="assets/icons/user.svg" width="20"
            height="20" /></button>
        
        <!-- MongoDB features (hidden when not logged in) -->
        <button class="icon-btn" id="btn-profile" title="H·ªì S∆°" onclick="mongoUI.showModal('userProfileModal')" style="display: none;"><img src="assets/icons/user.svg" width="20"
            height="20" /></button>
        <button class="icon-btn" id="btn-logout" title="ƒêƒÉng xu·∫•t" onclick="authUI.handleLogout()" style="display: none;"><img src="assets/icons/logout.svg" width="20"
            height="20" /></button>
        <div class="avatar" id="avatar">?</div>
      </div>
    </header>

    <main>
      <div class="main-scroll" id="view-home">
        <h2>Xin ch√†o, <span id="hello-name">b·∫°n.</span></h2>
        <p class="muted">Th√™m nh·∫°c, t·∫°o playlist v√† th∆∞·ªüng th·ª©c v·ªõi hi·ªáu ·ª©ng m∆∞·ª£t m√†.</p>
        <div class="cards">
          <div class="card">
            <div class="cover">Demo</div>
            <div class="meta">
              <div>
                <div class="title">√Çm 440Hz</div>
                <div class="muted">B·∫£n m·∫´u ƒë·ªÉ b·∫°n th·ª≠</div>
              </div>
              <button class="btn secondary" id="add-demo"><img src="assets/icons/add.svg" width="16" height="16" />
                Th√™m</button>
            </div>
          </div>
          <div class="card">
            <div class="cover">K√©o & Th·∫£</div>
            <div class="meta">
              <div>
                <div class="title">Th√™m file nhanh</div>
                <div class="muted">Th·∫£ file audio v√†o b·∫•t k·ª≥ ƒë√¢u</div>
              </div>
              <div class="tag">M·∫πo</div>
            </div>
          </div>
          <div class="card">
            <div class="cover">üéõÔ∏è</div>
            <div class="meta">
              <div>
                <div class="title">Tr√¨nh ph√°t nh·∫°c</div>
                <div class="muted">Shuffle, repeat, ph√≠m t·∫Øt, visualizer</div>
              </div>
              <div class="tag">M·ªõi</div>
            </div>
          </div>
        </div>
        
        <!-- Public Discovery Section -->
        <div class="section-header">
          <h2>üåç Kh√°m Ph√° Nh·∫°c T·ª´ C·ªông ƒê·ªìng</h2>
          <button class="btn ghost" id="btn-refresh-discovery">L√†m m·ªõi</button>
        </div>
        <div class="discovery-tracks" id="discovery-tracks">
          <div class="loading-message">ƒêang t·∫£i nh·∫°c t·ª´ c·ªông ƒë·ªìng...</div>
        </div>
      </div>

      <div class="main-scroll" id="view-library" hidden>
        <div class="toolbar">
          <h2>Th∆∞ vi·ªán</h2>
          <div style="display:flex; gap:8px;">
            <button class="btn secondary" id="btn-add-tracks"><img src="assets/icons/add.svg" width="16" height="16" />
              Th√™m b√†i h√°t</button>
            <button class="btn ghost" id="btn-online-search"><img src="assets/icons/search.svg" width="16"
                height="16" /> T√¨m nh·∫°c online</button>
            <button class="btn ghost" id="btn-history"><img src="assets/icons/list.svg" width="16" height="16" /> L·ªãch
              s·ª≠</button>
            <button class="btn ghost" id="btn-sleep-timer"><img src="assets/icons/moon.svg" width="16" height="16" />
              H·∫πn gi·ªù t·∫Øt</button>
          </div>
        </div>
        <div id="drop-zone" class="card"
          style="text-align:center; padding:30px; border:1px dashed rgba(124,92,255,.35);">
          <p>K√©o & th·∫£ file √¢m thanh v√†o ƒë√¢y ho·∫∑c b·∫•m "Th√™m b√†i h√°t".</p>
          <p style="font-size: 0.9em; opacity: 0.7; margin-top: 10px;">
            üíæ = Nh·∫°c local | ‚òÅÔ∏è = Nh·∫°c tr√™n MongoDB (c·∫ßn ƒëƒÉng nh·∫≠p)
          </p>
        </div>
        <table id="lib-table">
          <caption style="text-align:right; padding:4px 0;">
            <button class="btn ghost" id="btn-share-library"><img src="assets/icons/share.svg" width="16" height="16" />
              Chia s·∫ª th∆∞ vi·ªán</button>
          </caption>
          <thead>
            <tr>
              <th>#</th>
              <th>Ti√™u ƒë·ªÅ</th>
              <th>Ngh·ªá sƒ©</th>
              <th>Th·ªùi l∆∞·ª£ng</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="main-scroll" id="view-playlists" hidden>
        <div class="toolbar">
          <h2>Playlist</h2>
          <button class="btn" id="btn-create-playlist"><img src="assets/icons/add.svg" width="16" height="16" />
            Playlist m·ªõi</button>
        </div>
        <div class="cards" id="playlist-cards"></div>
        <div style="text-align:right; margin:8px 0;">
          <button class="btn ghost" id="btn-share-playlists"><img src="assets/icons/share.svg" width="16" height="16" />
            Chia s·∫ª t·∫•t c·∫£ playlist</button>
        </div>
        <div id="playlist-detail" hidden>
          <div class="toolbar">
            <div>
              <h3 id="pl-title" style="margin:0;"></h3>
              <div class="muted" id="pl-count"></div>
            </div>
            <div style="display:flex; gap:8px;">
              <button class="btn secondary" id="pl-play-all">Ph√°t t·∫•t c·∫£</button>
              <button class="btn ghost" id="pl-delete"><img src="assets/icons/delete.svg" width="16" height="16" />
                X√≥a</button>
              <button class="btn ghost" id="pl-share"><img src="assets/icons/share.svg" width="16" height="16" /> Chia
                s·∫ª</button>
            </div>
          </div>
          <table id="pl-table">
            <thead>
              <tr>
                <th>#</th>
                <th>B√†i h√°t</th>
                <th>Ngh·ªá sƒ©</th>
                <th>Th·ªùi l∆∞·ª£ng</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="main-scroll" id="view-settings" hidden>
        <h2>C√†i ƒë·∫∑t</h2>
        <div class="card">
          <div class="meta">
            <div>
              <div class="title">Giao di·ªán</div>
              <div class="muted">Chuy·ªÉn ƒë·ªïi s√°ng/t·ªëi, hi·ªáu ·ª©ng</div>
            </div>
            <button class="btn secondary" id="btn-theme">ƒê·ªïi ch·ªß ƒë·ªÅ</button>
          </div>
        </div>
      </div>
    </main>

    <div class="player" aria-label="Tr√¨nh ph√°t">
      <div class="info">
        <div class="thumb" id="thumb">‚ô™</div>
        <div>
          <div class="title" id="now-title">Ch∆∞a ph√°t</div>
          <div class="muted" id="now-artist">‚Äî</div>
        </div>
      </div>
      <div>
        <canvas id="viz" height="60"></canvas>
        <div class="controls" style="margin-top:6px;">
          <button class="ctrl" id="btn-prev"><img src="assets/icons/prev.svg" width="20" height="20" /></button>
          <button class="ctrl" id="btn-play"><img id="play-icon" src="assets/icons/play.svg" width="20" height="20" /></button>
          <button class="ctrl" id="btn-next"><img src="assets/icons/next.svg" width="20" height="20" /></button>
          <div class="slider" style="flex:1; padding:0 10px;">
            <span class="muted" id="cur-time">0:00</span>
            <input type="range" id="seek" min="0" max="100" value="0" />
            <span class="muted" id="dur-time">0:00</span>
          </div>
        </div>
      </div>
      <div class="right">
        <button class="ctrl" id="btn-shuffle"><img src="assets/icons/shuffle.svg" width="20" height="20" /></button>
        <button class="ctrl" id="btn-repeat"><img src="assets/icons/repeat.svg" width="20" height="20" /></button>
        <div class="slider" style="width:200px;"><img src="assets/icons/volume.svg" width="20" height="20" /><input
            type="range" id="volume" min="0" max="1" step="0.01" value="0.8" /></div>
      </div>
      <audio id="audio" crossorigin="anonymous"></audio>
    </div>
  </div>

  <!-- Profile Edit Modal -->
  <div class="modal" id="profile-modal" aria-modal="true">
    <div class="modal-card">
      <h2>Ch·ªânh s·ª≠a h·ªì s∆°</h2>
      <div class="row" style="align-items:center; gap:16px;">
        <img id="profile-ava-preview" src="" alt="avatar"
          style="width:64px;height:64px;border-radius:50%;object-fit:cover;background:#eee;">
        <input type="file" id="profile-ava-input" accept="image/*" style="display:none;">
        <button class="btn secondary" id="btn-upload-ava">ƒê·ªïi ·∫£nh</button>
      </div>
      <div class="row" style="margin-top:10px;">
        <input id="profile-name" placeholder="T√™n hi·ªÉn th·ªã" />
      </div>
      <div class="row" style="margin-top:10px;">
        <input id="profile-oldpass" type="password" placeholder="M·∫≠t kh·∫©u c≈© (ƒë·ªÉ ƒë·ªïi m·∫≠t kh·∫©u)" />
      </div>
      <div class="row" style="margin-top:10px;">
        <input id="profile-newpass" type="password" placeholder="M·∫≠t kh·∫©u m·ªõi (b·ªè qua n·∫øu kh√¥ng ƒë·ªïi)" />
      </div>
      <div class="row" style="margin-top:14px; gap:8px;">
        <button class="btn" id="btn-save-profile">L∆∞u</button>
        <button class="btn ghost" id="btn-cancel-profile">H·ªßy</button>
      </div>
      <p class="hint" style="margin-top:8px;">Ch·ªâ c·∫ßn nh·∫≠p v√†o √¥ mu·ªën ƒë·ªïi. ƒê·ªÉ ƒë·ªïi m·∫≠t kh·∫©u c·∫ßn nh·∫≠p ƒë√∫ng m·∫≠t kh·∫©u c≈©.
      </p>
    </div>
  </div>

  <!-- Online Search Modal -->
  <div class="modal" id="online-search-modal" aria-modal="true">
    <div class="modal-card">
      <h2>üéµ T√¨m ki·∫øm & Th√™m nh·∫°c online</h2>
      <div class="row">
        <input id="online-search-input" placeholder="T√¨m ki·∫øm ho·∫∑c paste link (.mp3, .wav, YouTube URL)..." style="flex:1;" />
        <button class="btn" id="btn-online-search-go">T√¨m</button>
      </div>
      <p style="color:var(--muted); font-size:12px; margin:8px 0 0 0;">
        üéµ <strong>Nhi·ªÅu ngu·ªìn</strong>: Jamendo, Internet Archive, Free Music ‚Ä¢ üîó <strong>Link tr·ª±c ti·∫øp</strong>: .mp3, .wav, .ogg ‚Ä¢ üì∫ <strong>YouTube</strong>: √Çm thanh t·ªïng h·ª£p
      </p>
      <div id="online-search-results" style="max-height:300px;overflow:auto;margin-top:10px;"></div>
      <div class="row" style="margin-top:14px; gap:8px;">
        <button class="btn ghost" id="btn-close-online-search">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div class="modal" id="history-modal" aria-modal="true">
    <div class="modal-card">
      <h2>L·ªãch s·ª≠ nghe & G·ª£i √Ω</h2>
      <div id="history-list" style="max-height:300px;overflow:auto;"></div>
      <div class="row" style="margin-top:14px; gap:8px;">
        <button class="btn ghost" id="btn-close-history">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div class="modal" id="share-modal" aria-modal="true">
    <div class="modal-card">
      <h2>Chia s·∫ª</h2>
      <div id="share-link"
        style="word-break:break-all; background:#f5f7fb; color:#1d2233; padding:8px; border-radius:8px; margin-bottom:10px;">
      </div>
      <button class="btn" id="btn-copy-share-link">Sao ch√©p link</button>
      <button class="btn ghost" id="btn-close-share">ƒê√≥ng</button>
    </div>
  </div>

  <!-- Sleep Timer Modal -->
  <div class="modal" id="sleep-timer-modal" aria-modal="true">
    <div class="modal-card">
      <h2>H·∫πn gi·ªù t·∫Øt nh·∫°c</h2>
      <div class="row">
        <input id="sleep-minutes" type="number" min="1" max="180" placeholder="S·ªë ph√∫t..." style="width:100px;" />
        <button class="btn" id="btn-set-sleep">B·∫Øt ƒë·∫ßu</button>
      </div>
      <div id="sleep-timer-status" style="margin-top:10px;color:var(--muted);"></div>
      <div class="row" style="margin-top:14px; gap:8px;">
        <button class="btn ghost" id="btn-cancel-sleep">H·ªßy</button>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toasts" id="toasts"></div>

  <!-- Scripts -->
  <script type="module" src="scripts/storage.js"></script>
  <script type="module" src="scripts/main.js"></script>
  <script src="scripts/api-client.js"></script>
  <script src="scripts/mongodb-ui.js"></script>
  <script src="scripts/auth-ui.js"></script>
  <script src="scripts/discovery.js"></script>
  <script type="module" src="scripts/profile-ui.js"></script>
  <script type="module" src="scripts/share.js"></script>
  <script type="module" src="scripts/youtube-api.js"></script>
  <script type="module" src="scripts/online-search.js"></script>
  <script type="module" src="scripts/history.js"></script>
  <script type="module" src="scripts/sleep-timer.js"></script>
  <script type="module" src="scripts/dragdrop.js"></script>
</body>

</html>